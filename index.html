<!DOCTYPE html>
<html lang="vi">
  <head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-QC846KQX9T"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);} 
      gtag('js', new Date());
      gtag('config', 'G-QC846KQX9T');
    </script>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Free SEO Checker</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.1"></script>
    <style>
      :root {
        --bg: #f6f7fb;
        --border: #dfe3eb;
        --text: #1f2330;
        --muted: #1e4084;
        --primary: #243d72;
        --primary-700: #5a46ca;
        --green: #21c185;
        --orange: #ff9f43;
        --red: #ef4444;
        --card: #ffffff;
      }
      * { box-sizing: border-box; }
      html, body { height: 100%; }
      body {
        margin: 0;
        font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        background: var(--bg);
        color: var(--text);
      }
      .topbar {
        height: 60px;
        background: var(--primary);
        color: #fff;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 20px;
      }
      .topbar .brand { font-weight: 700; letter-spacing: .2px; }
      .topbar .brand img { height: 28px; display: block; }
      .header-actions { display: flex; align-items: center; gap: 22px; }
      .header-btn { display: inline-flex; align-items: center; gap: 10px; color: #fff; text-decoration: none; font-weight: 600; font-size: 15px; opacity: .95; }
      .header-btn img { width: 18px; height: 18px; object-fit: contain; }
      .container {
        max-width: 1100px;
        margin: 24px auto 40px;
        padding: 0 12px;
      }
      .row { display: flex; gap: 20px; align-items: flex-start; }
      .col { flex: 1; }
      .col-2 { flex: 2; }
      .card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 16px;
      }
      /* Sticky right column */
      .sticky-column { position: sticky; top: 24px; height: fit-content; align-self: flex-start; }
      @media (max-width: 900px) { .sticky-column { position: static; } }
      .section-title {
        font-weight: 600;
        margin: 16px 0 8px;
        color: var(--muted);
        text-transform: uppercase;
        font-size: 12px;
        letter-spacing: .6px;
      }
      .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
      label { display: block; font-size: 12px; color: var(--text); font-weight: 700; margin-bottom: 6px; }
      input[type=text], textarea, input[type=url] {
        width: 100%;
        border: 1px solid var(--border);
        border-radius: 10px;
        padding: 10px 12px;
        font-size: 14px;
        outline: none;
        background: #fff;
        font-family: inherit;
      }
      textarea { resize: vertical; }
      .title-box { resize: none; }
      .content-editor { min-height: 220px; }
      .platforms { display: flex; gap: 10px; margin-bottom: 12px; }
      .chip {
        background: #fff;
        border: 1px solid var(--border);
        border-radius: 999px;
        padding: 8px 12px;
        font-size: 13px;
        color: var(--text);
        cursor: default;
      }
      .btn {
        background: var(--primary);
        color: #fff;
        border: none;
        border-radius: 12px;
        padding: 14px 20px;
        font-weight: 600;
        cursor: pointer;
        transition: background .15s ease;
      }
      .btn:hover { background: var(--primary-700); }
      .btn-full { width: 100%; }
      .score-box { display: flex; align-items: center; justify-content: space-between; gap: 12px; }
      .score-box { padding: 10px 12px; }
      .score-left { display:flex; flex-direction:column; }
      .score-right { display:flex; align-items:center; justify-content:center; gap:10px; flex:1; }
      .score-number { font-size: 44px; font-weight: 800; color: var(--green); }
      .score-icon { width: 44px; height: 44px; object-fit: contain; }
      .score-message { color: var(--green); font-size: 16px; font-weight: 600; text-align: center; }
      /* Tone overrides for dynamic score coloring */
      .score-number.tone-green { color: var(--green); }
      .score-number.tone-orange { color: var(--orange); }
      .score-number.tone-red { color: var(--red); }
      .score-message.tone-green { color: var(--green); }
      .score-message.tone-orange { color: var(--orange); }
      .score-message.tone-red { color: var(--red); }
      /* Floating sticky counter for content */
      .content-header-row { align-items: center; }
      .count-floating { position: sticky; top: 8px; right: 0; background: rgba(255,255,255,.85); border: none; border-radius: 8px; padding: 2px 8px; }
      .hint { color: var(--muted); font-size: 12px; }
      .score-box.center { justify-content: center; }
      .legend-title { font-weight: 700; margin: 4px 0 8px; text-align: center; }
      .legend-list { list-style: none; padding: 0; margin: 0; }
      .legend-item { display: flex; align-items: flex-start; gap: 8px; padding: 6px 0; font-size: 14px; }
      .dot { width: 10px; height: 10px; border-radius: 999px; margin-top: 5px; }
      .dot.green { background: var(--green); }
      .dot.orange { background: var(--orange); }
      .dot.red { background: var(--red); }
      .criteria-title { font-weight: 600; margin: 8px 0; }
      .empty-state { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 24px 10px; text-align: center; }
      .empty-icon { font-size: 48px; margin-bottom: 12px; }
      .empty-text { color: var(--red); }
      .footer { text-align: center; color: var(--muted); font-size: 12px; padding: 20px 0; }
      .help { color: #f3f7ff; font-size: 12px; cursor: pointer; text-decoration: none; font-weight: 400; }
      /* Card variants */
      .card.no-border { border: none; }
      .padded-lg { padding: 20px; }
      .help:hover { text-decoration: underline; font-weight: 700; }
      .flex-between { display: flex; justify-content: space-between; align-items: center; }
      .tiny { font-size: 12px; color: #8a93a5; }
      .score-left { align-items: center; }
      @keyframes pulseFade { 0% { opacity: .6; } 50% { opacity: 1; } 100% { opacity: .6; } }
      .score-number.loading { color: var(--muted); animation: pulseFade .6s ease infinite; }
      
      /* Ẩn/hiện thông tin đếm từ */
      .field-info { 
        opacity: 0; 
        visibility: hidden; 
        transition: all 0.3s ease; 
        transform: translateY(-5px);
      }
      .field-container:focus-within .field-info { 
        opacity: 1; 
        visibility: visible; 
        transform: translateY(0);
      }
      /* Hiển thị bộ đếm ngang với tiêu đề Nội dung */
      .field-container { position: relative; }
      .content-section-header .field-info { opacity: 1; visibility: visible; transform: none; }
      
      /* Hiệu ứng màu xanh khi đạt yêu cầu SEO */
      .field-info.seo-good { 
        color: var(--green); 
        font-weight: 600;
      }
      .field-info.seo-good .tiny:first-child { 
        color: var(--green); 
      }
      /* Coffee modal */
      .coffee-modal { position: fixed; inset: 0; background: rgba(31,35,48,.42); display: flex; align-items: center; justify-content: center; z-index: 9999; }
      .coffee-modal.hidden { display: none; }
      .coffee-dialog { position: relative; background: #fff; border-radius: 16px; padding: 40px 24px; max-width: 640px; width: 92%; box-shadow: 0 20px 40px rgba(0,0,0,.20); text-align: center; border: 2px solid rgba(108,89,217,.3); }
      .coffee-close { position: absolute; top: 14px; right: 16px; font-size: 18px; color: #8a93a5; cursor: pointer; }
      .coffee-hero { width: 100%; max-height: 320px; object-fit: contain; margin: 10px 0 22px; }
      .coffee-title { font-weight: 800; color: var(--primary); letter-spacing: 2px; margin-bottom: 8px; font-size: 18px; text-transform: uppercase; }
      .coffee-hey { font-weight: 800; color: var(--primary); letter-spacing: .6px; margin: 6px 0 12px; font-size: 22px; }
      .coffee-sub { color: #6b7280; font-size: 14px; margin-bottom: 14px; line-height: 1.6; padding: 0 30px; }
      .coffee-sub small { display: block; color: #8a93a5; margin-top: 6px; font-size: inherit;}
      .coffee-sub.coffee-support { margin-top: 8px; margin-bottom: 6px; }
      .coffee-sub.coffee-note { margin-top: 14px; }
      .coffee-actions .btn { min-height: 50px; border-radius: 16px; padding: 14px 22px; font-size: 14px; box-shadow: 0 6px 16px rgba(108,89,217,.35); display: inline-flex; align-items: center; gap: 12px; text-decoration: none; }
      .coffee-actions .btn:hover { text-decoration: none; }
      .coffee-actions .btn .cup { font-size: 20px; }
      /* Floating Buy me a coffee button */
      .coffee-fab { position: fixed; right: 24px; bottom: 24px; background: var(--primary); color: #fff; border: 2px solid rgba(108,89,217,.45); border-radius: 999px; padding: 10px 12px; font-weight: 300; display: inline-flex; align-items: center; gap: 10px; box-shadow: 0 10px 24px rgba(36,61,114,.35); z-index: 9998; text-decoration: none; font-size: 14px; }
      .coffee-fab:hover { background: var(--primary-700); }
      .coffee-fab .divider { width: 1px; height: 18px; background: rgba(255,255,255,.5); }
      .coffee-fab .icon { width: 20px; height: 20px; object-fit: contain; }
      .coffee-fab .emoji { font-size: 20px; line-height: 1; }

      /* Guide modal */
      .guide-modal { position: fixed; inset: 0; background: rgba(31,35,48,.42); display: flex; align-items: center; justify-content: center; z-index: 9999; }
      .guide-modal.hidden { display: none; }
      .guide-dialog { position: relative; background: #fff; border-radius: 16px; padding: 26px 22px; max-width: 720px; width: 92%; box-shadow: 0 20px 40px rgba(0,0,0,.20); border: 2px solid rgba(108,89,217,.3); user-select: none; }
      .guide-close { position: absolute; top: 12px; right: 14px; font-size: 22px; color: #8a93a5; cursor: pointer; }
      .guide-title { font-weight: 800; color: var(--primary); letter-spacing: .6px; margin: 4px 0 14px; font-size: 18px; text-align: center; }
      .guide-list { list-style: disc; padding-left: 22px; margin: 0; color: #374151; font-size: 14px; line-height: 1.6; }
      .guide-list li { margin: 6px 0; }
      .guide-table { width: 100%; border-collapse: collapse; margin: 0; color: #374151; font-size: 14px; line-height: 1.6; table-layout: fixed; }
      .guide-table th, .guide-table td { padding: 8px 10px; border-bottom: 1px solid var(--border); vertical-align: top; }
      .guide-table th { text-align: left; color: var(--primary); font-weight: 700; }
      .guide-table col.criteria-col { width: 33.33%; }
      .guide-table col.content-col { width: 66.67%; }

      /* Updates modal */
      .updates-modal { position: fixed; inset: 0; background: rgba(31,35,48,.42); display: flex; align-items: center; justify-content: center; z-index: 9999; }
      .updates-modal.hidden { display: none; }
      .updates-dialog { position: relative; background: #fff; border-radius: 16px; padding: 0; max-width: 980px; width: 94%; box-shadow: 0 20px 40px rgba(0,0,0,.20); border: 2px solid rgba(108,89,217,.3); overflow: hidden; }
      .updates-close { position: absolute; top: 12px; right: 14px; font-size: 22px; color: #8a93a5; cursor: pointer; }
      .updates-img { display: block; width: 100%; height: auto; }
  
      </style>
  </head>
  <body>
    <div id="app">
    <header class="topbar">
      <div class="brand"><img src="Icon SEO point/logo-ea.png" alt="Express Agency" /></div>
      <div class="header-actions">
        <a id="guideLink" href="#guide" class="header-btn">
          <img src="Icon SEO point/vuesax/linear/document-text.png" alt="Guide" />
          <span id="guideText"></span>
        </a>
        <a id="nextLink" href="#next" class="header-btn">
          <img src="Icon SEO point/Icon.png" alt="What's next" />
          <span id="nextText"></span>
        </a>
        <button id="langToggle" class="header-btn" style="background:none;border:none;padding:0;cursor:pointer">
          <span id="langText"></span>
        </button>
      </div>
    </header>
    <div class="container">

      <div class="row">
        <!-- Left: Form -->
        <div class="col-2 card">
          <div class="section-title">{{ tr('section.attributes') }}</div>
          <div class="grid-2">
            <div class="field-container">
              <label>{{ tr('label.mainKeyword') }}</label>
              <input type="text" @keydown="selectAllShortcut" v-model.trim="mainKeyword" :placeholder="tr('placeholder.mainKeyword')" />
              <div class="flex-between field-info" :class="{ 'seo-good': isMainKeywordGood() }">
                <div class="tiny">{{ tr('hint.keywordStandard') }}</div>
                <div class="tiny">{{ tr('hint.wordCount') }} {{ countWords(mainKeyword) }}</div>
              </div>
            </div>
            <div class="field-container">
              <label>{{ tr('label.secondaryKeyword') }}</label>
              <input type="text" @keydown="selectAllShortcut" v-model.trim="secondaryKeyword" :placeholder="tr('placeholder.secondaryKeyword')" />
              <div class="flex-between field-info" :class="{ 'seo-good': isSecondaryKeywordGood() }">
                <div class="tiny">{{ tr('hint.keywordStandard') }}</div>
                <div class="tiny">{{ tr('hint.wordCount') }} {{ countWords(secondaryKeyword) }}</div>
              </div>
            </div>
          </div>

          <div style="margin-top:14px"></div>
          <div class="field-container">
            <label>{{ tr('label.title') }}</label>
            <textarea rows="2" class="title-box" @keydown="selectAllShortcut" v-model.trim="title" :placeholder="tr('placeholder.title')"></textarea>
            <div class="flex-between field-info" :class="{ 'seo-good': isTitleGood() }">
              <div class="tiny">{{ tr('hint.titleLength') }}</div>
              <div class="tiny">{{ tr('hint.charCount') }} {{ countChars(title) }}</div>
            </div>
          </div>

          <div style="margin-top:14px"></div>
          <div class="field-container">
            <label>{{ tr('label.meta') }}</label>
            <textarea rows="3" @input="autoResize($event)" @keydown="selectAllShortcut" v-model.trim="meta" :placeholder="tr('placeholder.meta')"></textarea>
            <div class="flex-between field-info" :class="{ 'seo-good': isMetaGood() }">
              <div class="tiny">{{ tr('hint.metaWords') }}</div>
              <div class="tiny">{{ tr('hint.wordCount') }} {{ countWords(meta) }}</div>
            </div>
          </div>

          <div style="margin-top:14px"></div>
          <div>
            <label>{{ tr('label.url') }}</label>
            <input type="url" @keydown="selectAllShortcut" @paste="normalizeUrlPaste" @focus="ensureUrlPrefix" v-model.trim="url" placeholder="http://" />
          </div>

          <div class="flex-between content-section-header" style="margin-top:16px; align-items:center">
            <div class="section-title" style="margin:0">{{ tr('section.content') }}</div>
            <div class="tiny field-info" :class="{ 'seo-good': isContentGood() }">{{ tr('hint.wordCount') }} {{ contentWordCount() }}</div>
          </div>
          <div class="field-container">
            <textarea id="editor" class="content-editor" :placeholder="tr('placeholder.content')"></textarea>
          </div>
        </div>

        <!-- Right: Score -->
        <div class="col card sticky-column">
          <div class="flex-between" style="margin-bottom:12px">
            <button class="btn btn-full" @click="checkSEO">{{ tr('action.checkSEO') }}</button>
          </div>

          <div class="score-box" :class="{ center: noData }">
            <div class="score-left">
              <div class="tiny">{{ tr('score.title') }}</div>
              <div class="score-number" :class="[{ loading: isScoring }, toneClass]">{{ noData ? 'N/A' : (isScoring ? '...' : formatScore(score)) }}</div>
            </div>
            <div class="score-right" v-if="!noData">
              <img v-if="!noData && scoreIcon" class="score-icon" :src="scoreIcon" alt="SEO icon" />
              <div class="score-message" :class="toneClass" v-if="!noData">{{ scoreHint }}</div>
            </div>
          </div>

            <div class="card no-border padded-lg" style="margin-top:14px">
            <div class="legend-title">{{ tr('legend.title') }}</div>
            <div v-if="noData" class="empty-state">
              <div class="empty-icon">⚠️</div>
              <div class="empty-text">{{ tr('empty.noData') }}<br/>{{ tr('empty.fillContent') }}</div>
            </div>
            <template v-else>
              <div>
                <div class="criteria-title">{{ tr('criteria.good') }}</div>
                <ul class="legend-list">
                  <li class="legend-item" v-for="item in lists.green" :key="item.key">
                    <span class="dot green"></span>
                    <span>{{ item.msg }}</span>
                  </li>
                </ul>
              </div>
              <div class="stack-section" v-if="lists.orange.length">
                <div class="criteria-title">{{ tr('criteria.improve') }}</div>
                <ul class="legend-list">
                  <li class="legend-item" v-for="item in lists.orange" :key="item.key">
                    <span class="dot orange"></span>
                    <span>{{ item.msg }}</span>
                  </li>
                </ul>
              </div>
              <div class="stack-section" v-if="lists.red.length">
                <div class="criteria-title">{{ tr('criteria.fail') }}</div>
                <ul class="legend-list">
                  <li class="legend-item" v-for="item in lists.red" :key="item.key">
                    <span class="dot red"></span>
                    <span>{{ item.msg }}</span>
                  </li>
                </ul>
              </div>
            </template>
          </div>
        </div>
      </div>

      <div class="footer">{{ tr('footer.text') }}</div>
    </div>

    <!-- Floating Buy me a coffee button -->
    <a id="coffeeFab" href="#" class="coffee-fab" :aria-label="tr('coffee.fab')">
      <span class="emoji">☕️</span>
      <span class="divider"></span>
      <span>{{ tr('coffee.fab') }}</span>
    </a>

    <!-- Guide Modal -->
    <div id="guideModal" class="guide-modal hidden" role="dialog" aria-modal="true" aria-labelledby="guideTitle">
      <div class="guide-dialog">
        <div id="guideClose" class="guide-close" :aria-label="tr('aria.close')">×</div>
        <div id="guideTitle" class="guide-title">{{ tr('guide.title') }}</div>
        <table class="guide-table" aria-label="Hướng dẫn SEO">
          <colgroup>
            <col class="criteria-col" />
            <col class="content-col" />
          </colgroup>
          <thead>
            <tr>
              <th>{{ tr('guide.table.criteria') }}</th>
              <th>{{ tr('guide.table.content') }}</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>{{ tr('guide.r1.criteria') }}</td>
              <td>{{ tr('guide.r1.content') }}</td>
            </tr>
            <tr>
              <td>{{ tr('guide.r2.criteria') }}</td>
              <td>{{ tr('guide.r2.content') }}</td>
            </tr>
            <tr>
              <td>{{ tr('guide.r3.criteria') }}</td>
              <td>{{ tr('guide.r3.content') }}</td>
            </tr>
            <tr>
              <td>{{ tr('guide.r4.criteria') }}</td>
              <td>{{ tr('guide.r4.content') }}</td>
            </tr>
            <tr>
              <td>{{ tr('guide.r5.criteria') }}</td>
              <td>{{ tr('guide.r5.content') }}</td>
            </tr>
            <tr>
              <td>{{ tr('guide.r6.criteria') }}</td>
              <td>{{ tr('guide.r6.content') }}</td>
            </tr>
            <tr>
              <td>{{ tr('guide.r7.criteria') }}</td>
              <td>{{ tr('guide.r7.content') }}</td>
            </tr>
            <tr>
              <td>{{ tr('guide.r8.criteria') }}</td>
              <td>{{ tr('guide.r8.content') }}</td>
            </tr>
            <tr>
              <td>{{ tr('guide.r9.criteria') }}</td>
              <td>{{ tr('guide.r9.content') }}</td>
            </tr>
            <tr>
              <td>{{ tr('guide.r10.criteria') }}</td>
              <td>{{ tr('guide.r10.content') }}</td>
            </tr>
            <tr>
              <td>{{ tr('guide.r11.criteria') }}</td>
              <td>{{ tr('guide.r11.content') }}</td>
            </tr>
            <tr>
              <td>{{ tr('guide.r12.criteria') }}</td>
              <td>{{ tr('guide.r12.content') }}</td>
            </tr>
            <tr>
              <td>{{ tr('guide.r13.criteria') }}</td>
              <td>{{ tr('guide.r13.content') }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Updates Modal (What's next?) -->
    <div id="updatesModal" class="updates-modal hidden" role="dialog" aria-modal="true">
      <div class="updates-dialog">
        <div id="updatesClose" class="updates-close" :aria-label="tr('aria.close')">×</div>
        <img src="Icon SEO point/WhatNext.jpg" alt="What's next" class="updates-img" />
      </div>
    </div>

    <!-- Coffee Modal -->
    <div id="coffeeModal" class="coffee-modal hidden" role="dialog" aria-modal="true" aria-labelledby="coffeeTitle">
      <div class="coffee-dialog">
        <div id="coffeeClose" class="coffee-close" :aria-label="tr('aria.close')">×</div>
        <div id="coffeeTitle" class="coffee-title">{{ tr('coffee.title') }}</div>
        <img src="Icon SEO point/Group 5.png" alt="Coffee illustration" class="coffee-hero" />
        <div class="coffee-body">
          <div class="coffee-hey">{{ tr('coffee.hey') }}</div>
          <div class="coffee-sub">{{ tr('coffee.sub') }}</div>
          <div class="coffee-sub coffee-support"><small>{{ tr('coffee.support') }}</small></div>
        </div>
        <div class="coffee-actions">
          <a class="btn" href="https://buymeacoffee.com/nhuquynh" target="_blank" rel="noopener"><span>☕</span><span>{{ tr('coffee.cta') }}</span></a>
        </div>
        <div class="coffee-sub coffee-note"><small>{{ tr('coffee.note') }}</small></div>
      </div>
    </div>

    </div>
    <!-- TinyMCE (community) via jsDelivr -->
    <script src="https://cdn.jsdelivr.net/npm/tinymce@6.8.3/tinymce.min.js"></script>
    <!-- VueJS via CDN -->
    <script src="https://unpkg.com/vue@3.4.27/dist/vue.global.prod.js"></script>
    <script>
      (function(){
        var style = document.createElement('style');
        style.textContent = '[v-cloak]{display:none}';
        document.head.appendChild(style);
      })();
      const I18N = {
        vi: {
          'menu.guide': 'Hướng dẫn',
          'menu.next': "What's next?",
          'section.attributes': 'Thuộc tính',
          'label.mainKeyword': 'Từ khóa chính',
          'placeholder.mainKeyword': 'VD: Laptop giá rẻ',
          'label.secondaryKeyword': 'Từ khóa phụ',
          'placeholder.secondaryKeyword': 'VD: Laptop sinh viên',
          'hint.keywordStandard': '3–5 từ · dưới 20 ký tự',
          'hint.wordCount': 'Số từ:',
          'hint.charCount': 'Số ký tự:',
          'label.title': 'Tiêu đề bài viết',
          'placeholder.title': 'Nhập tiêu đề bài viết',
          'hint.titleLength': '30–60 ký tự là tối ưu',
          'label.meta': 'Mô tả (Meta Description)',
          'placeholder.meta': 'Nhập mô tả ngắn',
          'hint.metaWords': '30–50 từ là đạt yêu cầu',
          'label.url': 'URL bài viết',
          'section.content': 'Nội dung',
          'placeholder.content': 'Dán nội dung bài viết hoặc viết tại đây',
          'action.checkSEO': 'Kiểm tra SEO (Ctrl + Enter)',
          'score.title': 'Điểm SEO',
          'legend.title': 'Đánh giá chi tiết',
          'empty.noData': 'Không có dữ liệu',
          'empty.fillContent': 'Vui lòng điền đủ nội dung',
          'criteria.good': 'Rất tốt',
          'criteria.improve': 'Cần cải thiện',
          'criteria.fail': 'Không đạt',
          'footer.text': 'CheckSeoVn v1.1.8 · Cảm ơn bạn đã ủng hộ cà phê :x',
          'aria.close': 'Đóng',
          'guide.title': 'HƯỚNG DẪN ĐẠT ĐIỂM SEO TỐI ĐA',
          'guide.table.criteria': 'Tiêu chí',
          'guide.table.content': 'Nội dung',
          'guide.r1.criteria': 'Từ khóa chính',
          'guide.r1.content': '3–5 từ, dưới 20 ký tự.',
          'guide.r2.criteria': 'Từ khóa phụ',
          'guide.r2.content': '3–5 từ, dưới 20 ký tự (nên có).',
          'guide.r3.criteria': 'Mật độ từ khóa',
          'guide.r3.content': '2,0%–6,0% tổng số từ. Công thức: (Số từ trong từ khóa × Số lần xuất hiện) / Tổng số từ × 100%.',
          'guide.r4.criteria': 'Tiêu đề',
          'guide.r4.content': '30–60 ký tự, từ khóa chính ở đầu.',
          'guide.r5.criteria': 'Mô tả meta',
          'guide.r5.content': '30–50 từ, chứa từ khóa chính.',
          'guide.r6.criteria': 'Nội dung',
          'guide.r6.content': '300–1800 từ, đoạn ngắn, dễ đọc.',
          'guide.r7.criteria': 'H1',
          'guide.r7.content': 'Có chứa từ khóa chính.',
          'guide.r8.criteria': 'H2 đầu tiên',
          'guide.r8.content': 'Nên chứa từ khóa chính.',
          'guide.r9.criteria': 'Đầu & cuối bài',
          'guide.r9.content': 'Từ khóa chính xuất hiện trong 100 từ đầu và cuối.',
          'guide.r10.criteria': 'Hình ảnh',
          'guide.r10.content': 'Ít nhất 1 ảnh, ALT chứa từ khóa chính.',
          'guide.r11.criteria': 'Liên kết nội bộ',
          'guide.r11.content': 'Link tới bài khác trong website.',
          'guide.r12.criteria': 'Liên kết ngoài',
          'guide.r12.content': 'Link tới nguồn đáng tin cậy khác domain.',
          'guide.r13.criteria': 'Bố cục',
          'guide.r13.content': 'Rõ ràng, dễ nhìn, có tiêu đề phụ và bullet points.',
          'coffee.fab': 'Buy me a coffee',
          'coffee.title': 'ĐANG PHÁT TRIỂN',
          'coffee.hey': 'HEYYOOOO!',
          'coffee.sub': 'Xin chào, tớ là Như Quỳnh - một cô gái làm truyền thông và yêu thích lập trình. Cảm ơn bạn đã quan tâm đến sản phẩm này ❤️ Tớ sẽ cố gắng cập nhật thêm các tính năng “so cool” trong tương lai!',
          'coffee.support': 'Nếu thích & ủng hộ, cứ thoải mái nhé',
          'coffee.cta': 'BUY ME A COFFEE',
          'coffee.note': 'và bạn sẽ được thêm vào PREMIUM để thử các tính năng mới sớm.',
          'confirm.exit': 'Dữ liệu sẽ bị mất, bạn có chắc muốn thoát?',
          'score.hint.master': 'Thưa ngài Master of SEO, ngài thật vô song!',
          'score.hint.great': 'Thật tuyệt! Bạn là cây bút xuất sắc đó',
          'score.hint.ok': 'Ayoo, dành thời gian cải thiện thêm chút nữa nha',
          'score.hint.bad': 'Úi, đừng publish bài viết này, hãy chỉnh sửa thêm',
          'score.hint.worst': 'Ơ bạn ơi, viết lách như này có lỗi với tổ nghề đấy',
          'result.r1_bad': 'Từ khóa chính/phụ chưa đạt chuẩn (3–5 từ, <20 ký tự)',
          'result.r1_good': 'Từ khóa chính/phụ đạt chuẩn (3–5 từ, <20 ký tự)',
          'result.r1_warn_nosub': 'Nên có từ khoá phụ',
          'result.r1_warn_standardize': 'Nên chuẩn hóa từ khóa (3–5 từ, <20 ký tự)',
          'result.r2_missing': 'Chưa có tiêu đề',
          'result.r2_good': 'Độ dài tiêu đề tốt (30–60 ký tự)',
          'result.r2_warn_short': 'tiêu đề quá ngắn',
          'result.r2_warn_long': 'tiêu đề quá dài',
          'result.r3_short': 'Mô tả quá ngắn (<30 từ)',
          'result.r3_good': 'Độ dài mô tả đạt yêu cầu (30–50 từ)',
          'result.r3_long': 'Mô tả quá dài (>50 từ)',
          'result.r4_ok': 'Độ dài nội dung tốt (300–1800 từ)',
          'result.r4_warn': 'Nên điều chỉnh độ dài nội dung',
          'result.r4_bad': 'Nội dung quá ngắn',
          'result.r5_bad': 'Tiêu đề không chứa từ khóa chính',
          'result.r5_good': 'Từ khóa chính nằm ngay đầu tiêu đề',
          'result.r5_warn': 'Nên đưa từ khóa chính lên đầu tiêu đề',
          'result.r6_bad': 'Meta thiếu từ khóa chính',
          'result.r6_good': 'Meta có từ khóa chính',
          'result.r6_warn': 'Nên thêm từ khóa chính vào meta',
          'result.r7_bad': 'Không có H1 chứa từ khóa chính',
          'result.r7_good': 'Ít nhất một H1 chứa từ khóa chính',
          'result.r7_warn': 'Nên thêm từ khóa chính vào H1',
          'result.r8_warn': 'Nên đưa từ khóa chính vào H2 đầu tiên',
          'result.r8_good': 'H2 đầu tiên chứa từ khóa chính',
          'result.r9_bad': 'Không xuất hiện ở cả đoạn đầu lẫn đoạn cuối',
          'result.r9_good': 'Từ khóa chính xuất hiện ở đầu và cuối bài',
          'result.r9_warn': 'Nên xuất hiện ở cả đoạn đầu và đoạn cuối',
          'result.r10_bad': 'Không có hình ảnh nào',
          'result.r10_good': 'Có ảnh với ALT chứa từ khóa chính',
          'result.r10_warn': 'Nên bổ sung từ khóa chính trong ALT ảnh',
          'result.r11_warn': 'Nên có liên kết ngoài domain',
          'result.r11_good': 'Có ≥1 liên kết ngoài domain',
          'result.r12_warn_valid': 'Nên có liên kết nội bộ',
          'result.r12_warn_nourl': 'Nên nhập link bài viết để kiểm tra SEO tốt hơn',
          'result.r12_good': 'Có ≥1 liên kết nội bộ',
          'result.r13_low': 'Mật độ từ khóa thấp (%s%)',
          'result.r13_ok': 'Mật độ từ khóa đạt yêu cầu (%s%)',
          'result.r13_high': 'Nên giảm mật độ từ khóa (%s%)'
        },
        en: {
          'menu.guide': 'Guide',
          'menu.next': "What's next?",
          'section.attributes': 'Attributes',
          'label.mainKeyword': 'Main keyword',
          'placeholder.mainKeyword': 'e.g. Cheap laptop',
          'label.secondaryKeyword': 'Secondary keyword',
          'placeholder.secondaryKeyword': 'e.g. Student laptop',
          'hint.keywordStandard': '3–5 words · under 20 chars',
          'hint.wordCount': 'Words:',
          'hint.charCount': 'Chars:',
          'label.title': 'Article title',
          'placeholder.title': 'Enter article title',
          'hint.titleLength': '30–60 chars is optimal',
          'label.meta': 'Meta description',
          'placeholder.meta': 'Enter short description',
          'hint.metaWords': '30–50 words is recommended',
          'label.url': 'Article URL',
          'section.content': 'Content',
          'placeholder.content': 'Paste content or write here',
          'action.checkSEO': 'Check SEO (Ctrl + Enter)',
          'score.title': 'SEO score',
          'legend.title': 'Detailed evaluation',
          'empty.noData': 'No data',
          'empty.fillContent': 'Please fill in all content',
          'criteria.good': 'Great',
          'criteria.improve': 'Needs improvement',
          'criteria.fail': 'Failed',
          'footer.text': 'CheckSeoVn v1.1.8 · Thanks for your coffee support :x',
          'aria.close': 'Close',
          'guide.title': 'GUIDE TO MAX SEO SCORE',
          'guide.table.criteria': 'Criteria',
          'guide.table.content': 'Content',
          'guide.r1.criteria': 'Main keyword',
          'guide.r1.content': '3–5 words, under 20 chars.',
          'guide.r2.criteria': 'Secondary keyword',
          'guide.r2.content': '3–5 words, under 20 chars (recommended).',
          'guide.r3.criteria': 'Keyword density',
          'guide.r3.content': '2.0%–6.0% of total words. Formula: (KW words × occurrences) / total words × 100%.',
          'guide.r4.criteria': 'Title',
          'guide.r4.content': '30–60 chars, main keyword at the start.',
          'guide.r5.criteria': 'Meta description',
          'guide.r5.content': '30–50 words, include main keyword.',
          'guide.r6.criteria': 'Content',
          'guide.r6.content': '300–1800 words, short paragraphs, readable.',
          'guide.r7.criteria': 'H1',
          'guide.r7.content': 'Contains the main keyword.',
          'guide.r8.criteria': 'First H2',
          'guide.r8.content': 'Should include the main keyword.',
          'guide.r9.criteria': 'Beginning & end',
          'guide.r9.content': 'Main keyword appears in first 100 and last 100 words.',
          'guide.r10.criteria': 'Images',
          'guide.r10.content': 'At least 1 image; ALT contains main keyword.',
          'guide.r11.criteria': 'Internal links',
          'guide.r11.content': 'Link to other pages on the site.',
          'guide.r12.criteria': 'External links',
          'guide.r12.content': 'Link to trusted sources on other domains.',
          'guide.r13.criteria': 'Layout',
          'guide.r13.content': 'Clear, scannable, with subheadings and bullet points.',
          'coffee.fab': 'Buy me a coffee',
          'coffee.title': 'IN PROGRESS',
          'coffee.hey': 'HEYYOOOO!',
          'coffee.sub': "Hello, I'm Nhu Quynh — a girl in communications who loves coding. Thank you for checking out this product ❤️ I'll keep updating cool features in the future!",
          'coffee.support': 'If you like & support, feel free',
          'coffee.cta': 'BUY ME A COFFEE',
          'coffee.note': 'and you will be listed in PREMIUM to try new features soon.',
          'confirm.exit': 'Unsaved data will be lost. Are you sure to leave?',
          'score.hint.master': 'Master of SEO — unmatched!',
          'score.hint.great': 'Awesome! You’re an excellent writer',
          'score.hint.ok': 'Good work — refine a bit more',
          'score.hint.bad': 'Oops — don’t publish yet, please edit',
          'score.hint.worst': 'Hey, this writing breaks all rules — please fix',
          'result.r1_bad': 'Main/secondary keyword not standard (3–5 words, <20 chars)',
          'result.r1_good': 'Main/secondary keyword standard',
          'result.r1_warn_nosub': 'Add a secondary keyword',
          'result.r1_warn_standardize': 'Standardize keywords (3–5 words, <20 chars)',
          'result.r2_missing': 'Missing title',
          'result.r2_good': 'Good title length (30–60 chars)',
          'result.r2_warn_short': 'Title too short',
          'result.r2_warn_long': 'Title too long',
          'result.r3_short': 'Meta too short (<30 words)',
          'result.r3_good': 'Good meta length (30–50 words)',
          'result.r3_long': 'Meta too long (>50 words)',
          'result.r4_ok': 'Good content length (300–1800 words)',
          'result.r4_warn': 'Adjust content length',
          'result.r4_bad': 'Content too short',
          'result.r5_bad': 'Title lacks main keyword',
          'result.r5_good': 'Main keyword at start of title',
          'result.r5_warn': 'Place main keyword at the start',
          'result.r6_bad': 'Meta missing main keyword',
          'result.r6_good': 'Meta contains main keyword',
          'result.r6_warn': 'Add main keyword to meta',
          'result.r7_bad': 'No H1 contains main keyword',
          'result.r7_good': 'At least one H1 contains main keyword',
          'result.r7_warn': 'Add main keyword to an H1',
          'result.r8_warn': 'Add main keyword to the first H2',
          'result.r8_good': 'First H2 contains main keyword',
          'result.r9_bad': 'Missing in both beginning and end',
          'result.r9_good': 'Main keyword appears in beginning and end',
          'result.r9_warn': 'Ensure keyword appears at beginning and end',
          'result.r10_bad': 'No images',
          'result.r10_good': 'Image ALT contains main keyword',
          'result.r10_warn': 'Add main keyword to an image ALT',
          'result.r11_warn': 'Add an external link',
          'result.r11_good': 'Has ≥1 external link',
          'result.r12_warn_valid': 'Add an internal link',
          'result.r12_warn_nourl': 'Enter article URL for better checks',
          'result.r12_good': 'Has ≥1 internal link',
          'result.r13_low': 'Keyword density low (%s%)',
          'result.r13_ok': 'Keyword density OK (%s%)',
          'result.r13_high': 'Reduce keyword density (%s%)'
        }
      };
      const { createApp } = Vue;

      function escapeRegExp(string) {
        return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
      }

      function stripTags(html) {
        const tmp = document.createElement('div');
        tmp.innerHTML = html || '';
        return tmp.textContent || tmp.innerText || '';
      }

      function wordCount(text) {
        const cleaned = (text || '').replace(/\n/g, ' ').replace(/[^\p{L}\p{N}]+/gu, ' ').trim();
        if (!cleaned) return 0;
        return cleaned.split(/\s+/).length;
      }

      function toLower(text) { return (text || '').toLowerCase(); }

      const app = createApp({
        data() {
          return {
            lang: 'vi',
            mainKeyword: '',
            secondaryKeyword: '',
            title: '',
            meta: '',
            url: 'http://',
            content: '',
            score: 0,
            scoreHint: '',
            scoreIcon: '',
            scoreTone: 'green',
            lists: { green: [], orange: [], red: [] },
            objectUrls: [],
            noData: true,
            isScoring: false,
          };
        },
        computed: {
          toneClass() {
            if (this.noData) return '';
            const t = this.scoreTone || 'green';
            return `tone-${t}`;
          }
        },
        mounted() {
          // Load cached values then init editor
          this.loadCached();
          try {
            const cachedLang = localStorage.getItem('sc_lang');
            if (cachedLang === 'en' || cachedLang === 'vi') this.lang = cachedLang || 'vi';
            document.documentElement.lang = this.lang;
          } catch {}
          this.initEditor();
          this.refreshHeaderTexts();
          try {
            const langBtn = document.getElementById('langToggle');
            if (langBtn) langBtn.addEventListener('click', () => { this.toggleLang(); this.refreshHeaderTexts(); });
          } catch {}
          // Phím tắt toàn cục Ctrl/Cmd + Enter
          window.addEventListener('keydown', this.onShortcut);
          // Ctrl/Cmd + A: chọn toàn bộ nội dung trong input/textarea
          window.addEventListener('keydown', this.selectAllShortcut);
          // Cảnh báo khi reload/đóng trang
          window.addEventListener('beforeunload', this.onBeforeUnload);
          // Thu hồi Object URL khi đóng trang
          window.addEventListener('unload', this.revokeObjectUrls);
          this.checkSEO();
          // Bind Buy me a coffee modal
          try {
            const link = document.getElementById('coffeeLink');
            const guideLink = document.getElementById('guideLink');
            const guideModal = document.getElementById('guideModal');
            const guideClose = document.getElementById('guideClose');
            const fab = document.getElementById('coffeeFab');
            const modal = document.getElementById('coffeeModal');
            const close = document.getElementById('coffeeClose');
            if (link && modal) {
              link.addEventListener('click', (e) => { e.preventDefault(); modal.classList.remove('hidden'); });
            }
            if (fab && modal) {
              fab.addEventListener('click', (e) => { e.preventDefault(); modal.classList.remove('hidden'); });
            }
            // Guide modal bindings
            if (guideLink && guideModal) {
              guideLink.addEventListener('click', (e) => { e.preventDefault(); guideModal.classList.remove('hidden'); });
            }
            if (guideClose) guideClose.addEventListener('click', () => guideModal.classList.add('hidden'));
            if (guideModal) guideModal.addEventListener('click', (e) => { if (e.target === guideModal) guideModal.classList.add('hidden'); });
            // Updates modal bindings (What's next?)
            const nextLink = document.getElementById('nextLink');
            const updatesModal = document.getElementById('updatesModal');
            const updatesClose = document.getElementById('updatesClose');
            if (nextLink && updatesModal) {
              nextLink.addEventListener('click', (e) => { e.preventDefault(); updatesModal.classList.remove('hidden'); });
            }
            if (updatesClose) updatesClose.addEventListener('click', () => updatesModal.classList.add('hidden'));
            if (updatesModal) updatesModal.addEventListener('click', (e) => { if (e.target === updatesModal) updatesModal.classList.add('hidden'); });
            // Prevent selection & copy inside guide dialog
            if (guideModal) {
              const dialog = guideModal.querySelector('.guide-dialog');
              if (dialog) {
                dialog.addEventListener('copy', (e) => e.preventDefault());
                dialog.addEventListener('cut', (e) => e.preventDefault());
                dialog.addEventListener('selectstart', (e) => e.preventDefault());
                dialog.addEventListener('keydown', (e) => {
                  if ((e.ctrlKey || e.metaKey) && (e.key === 'c' || e.key === 'x')) e.preventDefault();
                });
              }
            }
            if (close) close.addEventListener('click', () => modal.classList.add('hidden'));
            if (modal) modal.addEventListener('click', (e) => { if (e.target === modal) modal.classList.add('hidden'); });
          } catch {}
        },
        watch: {
          mainKeyword(val) { try { localStorage.setItem('sc_mainKeyword', val || ''); } catch {} },
          secondaryKeyword(val) { try { localStorage.setItem('sc_secondaryKeyword', val || ''); } catch {} },
          title(val) { try { localStorage.setItem('sc_title', val || ''); } catch {} },
          meta(val) { try { localStorage.setItem('sc_meta', val || ''); } catch {} },
          url(val) { try { localStorage.setItem('sc_url', val || ''); } catch {} },
          content(val) { try { localStorage.setItem('sc_content', val || ''); } catch {} },
          lang(val) { try { localStorage.setItem('sc_lang', val || 'vi'); document.documentElement.lang = val || 'vi'; this.refreshHeaderTexts(); } catch {} },
        },
        methods: {
          tr(key) {
            try { return (I18N[this.lang] && I18N[this.lang][key]) || (I18N.vi && I18N.vi[key]) || key; } catch { return key; }
          },
          trp(key, ...args) {
            let s = this.tr(key);
            for (const a of args) { s = String(s).replace('%s', a); }
            return s;
          },
          toggleLang() { this.lang = this.lang === 'vi' ? 'en' : 'vi'; },
          refreshHeaderTexts() {
            try {
              const guide = document.getElementById('guideText');
              const next = document.getElementById('nextText');
              const langText = document.getElementById('langText');
              if (guide) guide.textContent = this.tr('menu.guide');
              if (next) next.textContent = this.tr('menu.next');
              if (langText) langText.textContent = (this.lang === 'vi' ? 'English' : 'Tiếng Việt');
            } catch {}
          },
          autoResize(e) {
            const t = e.target; t.style.height = 'auto'; t.style.height = t.scrollHeight + 'px';
          },
          loadCached() {
            try {
              this.mainKeyword = localStorage.getItem('sc_mainKeyword') || '';
              this.secondaryKeyword = localStorage.getItem('sc_secondaryKeyword') || '';
              this.title = localStorage.getItem('sc_title') || '';
              this.meta = localStorage.getItem('sc_meta') || '';
              this.url = localStorage.getItem('sc_url') || '';
              if (!this.url) this.url = 'http://';
              this.content = localStorage.getItem('sc_content') || '';
            } catch {}
          },
          selectAllShortcut(e) {
            const isSelectAll = (e.ctrlKey || e.metaKey) && (e.key === 'a' || e.key === 'A');
            if (!isSelectAll) return;
            const el = e.target;
            if (el && (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA')) {
              e.preventDefault();
              try {
                if (typeof el.select === 'function') {
                  el.select();
                } else if (typeof el.setSelectionRange === 'function') {
                  const val = el.value || '';
                  el.setSelectionRange(0, val.length);
                }
              } catch {}
            }
          },
          ensureUrlPrefix(e) {
            try {
              const val = (this.url || '').trim();
              if (!val) this.url = 'http://';
            } catch {}
          },
          normalizeUrlPaste(e) {
            try {
              const text = (e.clipboardData || window.clipboardData).getData('text');
              if (!text) return;
              e.preventDefault();
              const sanitized = text.trim().replace(/^https?:\/\/(.*)$/i, '$1');
              this.url = sanitized;
            } catch {}
          },
          countWords(v) { return wordCount((v || '').trim()); },
          countChars(v) { try { return (v || '').trim().length; } catch { return 0; } },
          contentWordCount() { return wordCount(stripTags(this.content || '')); },
          initEditor() {
            const vm = this;
            tinymce.init({
              selector: '#editor',
              plugins: 'autoresize link lists image table code',
              toolbar: 'undo redo | blocks | bold italic underline | link image | numlist bullist | table | code',
              menubar: false,
              branding: false,
              readonly: false,
              // Make pasted/uploaded images fit the editor iframe width
              content_style: 'body{padding:12px;} img{width:100% !important;height:auto !important;display:block;}',
              image_dimensions: false,
              object_resizing: false,
              // TinyMCE v6 expects a Promise-based images_upload_handler
              images_upload_handler: (blobInfo, progress) => new Promise((resolve, reject) => {
                try {
                  const blob = blobInfo.blob();
                  const url = URL.createObjectURL(blob);
                  vm.objectUrls.push(url);
                  // Optionally report progress; for Object URLs, it's instant
                  if (typeof progress === 'function') { progress(100); }
                  resolve(url);
                } catch (err) {
                  reject('Upload failed');
                }
              }),
              setup(editor) {
                editor.on('init', () => { editor.setContent(vm.content); });
                editor.on('change keyup undo redo', () => { vm.content = editor.getContent(); });
                editor.on('keydown', (e) => {
                  if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') { e.preventDefault(); vm.checkSEO(); }
                });
                // Normalize image nodes after paste/upload to ensure full-width
                const normalizeImages = () => {
                  try {
                    const imgs = editor.dom.select('img');
                    imgs.forEach(img => {
                      img.removeAttribute('width');
                      img.removeAttribute('height');
                      img.style.width = '100%';
                      img.style.height = 'auto';
                      img.style.display = 'block';
                    });
                  } catch {}
                };
                editor.on('PastePost', normalizeImages);
                editor.on('ObjectSelected', normalizeImages);
                editor.on('NodeChange', normalizeImages);
                // Ensure heading applies only to selected text by splitting the block
                editor.on('BeforeExecCommand', (e) => {
                  const cmd = e.command;
                  const val = e.value;
                  if ((cmd === 'mceBlock' || cmd === 'FormatBlock') && /^h[1-6]$/i.test(String(val || ''))) {
                    const selection = editor.selection;
                    if (selection && !selection.isCollapsed()) {
                      const level = String(val).toLowerCase().replace('h','') || '1';
                      const html = selection.getContent({ format: 'html' });
                      if (html) {
                        e.preventDefault();
                        editor.undoManager.transact(() => {
                          selection.setContent(`<h${level}>${html}</h${level}>`);
                        });
                      }
                    }
                  }
                });
              }
            });
          },
          onShortcut(e) {
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') { e.preventDefault(); this.checkSEO(); }
          },
          onBeforeUnload(e) {
            e.preventDefault();
            e.returnValue = this.tr('confirm.exit');
            return this.tr('confirm.exit');
          },
          revokeObjectUrls() {
            (this.objectUrls || []).forEach(u => { try { URL.revokeObjectURL(u); } catch {} });
          },
          checkSEO() {
            this.isScoring = true;
            const results = [];
            const kMain = toLower(this.mainKeyword.trim());
            const kSub = toLower(this.secondaryKeyword.trim());
            const title = this.title || '';
            const meta = this.meta || '';
            const url = this.url || '';
            const raw = this.content || '';
            // Prepare content text and DOM
            const wrapper = document.createElement('div');
            wrapper.innerHTML = raw;
            const text = stripTags(raw);

            // No data state: nếu thiếu từ khóa chính hoặc nội dung rỗng
            const noKeyword = !kMain;
            const noContent = !text.trim();
            this.noData = noKeyword || noContent;
            if (this.noData) {
              this.score = 0;
              this.scoreHint = '';
              this.lists = { green: [], orange: [], red: [] };
              this.isScoring = false;
              return;
            }

            // 1) Chuẩn từ khóa chính/phụ: 3–5 từ và <20 ký tự (0.5)
            const mainWords = wordCount(kMain);
            const subWords = wordCount(kSub);
            const mainChars = (kMain || '').length;
            const subChars = (kSub || '').length;
            const mainStd = mainWords >= 3 && mainWords <= 5 && mainChars < 20;
            const subStd = subWords >= 3 && subWords <= 5 && subChars < 20;
            let r1Status = 'red', r1Pts = 0, r1Msg = this.tr('result.r1_bad');
            if (mainStd && subStd) {
              r1Status = 'green'; r1Pts = 0.5; r1Msg = this.tr('result.r1_good');
            } else if (mainStd || subStd) {
              r1Status = 'orange'; r1Pts = 0.25;
              r1Msg = (!subStd && subWords === 0)
                ? this.tr('result.r1_warn_nosub')
                : this.tr('result.r1_warn_standardize');
            }
            results.push({ key: 1, status: r1Status, pts: r1Pts, msg: r1Msg });

            // 2) Độ dài tiêu đề (0.5)
            const titleLen = (title || '').trim().length;
            {
              let r2 = { key:2, status:'red', pts:0, msg:this.tr('result.r2_missing') };
              if (titleLen === 0) {
                r2 = { key:2, status:'red', pts:0, msg:this.tr('result.r2_missing') };
              } else if (titleLen >= 30 && titleLen <= 60) {
                r2 = { key:2, status:'green', pts:0.5, msg:this.tr('result.r2_good') };
              } else if (titleLen >= 20 && titleLen <= 29) {
                r2 = { key:2, status:'orange', pts:0.25, msg:this.tr('result.r2_warn_short') };
              } else if (titleLen < 20) {
                r2 = { key:2, status:'red', pts:0, msg:this.tr('result.r2_warn_short') };
              } else if (titleLen >= 61 && titleLen <= 70) {
                r2 = { key:2, status:'orange', pts:0.25, msg:this.tr('result.r2_warn_long') };
              } else {
                r2 = { key:2, status:'red', pts:0, msg:this.tr('result.r2_warn_long') };
              }
              results.push(r2);
            }

            // 3) Độ dài mô tả meta theo số từ (0.5)
            const metaWords = wordCount((meta || '').trim());
            let r3 = { key:3, status:'red', pts:0, msg:this.tr('result.r3_short') };
            if (metaWords >= 30 && metaWords <= 50) {
              r3 = { key:3, status:'green', pts:0.5, msg:this.tr('result.r3_good') };
            } else if (metaWords > 50) {
              r3 = { key:3, status:'red', pts:0, msg:this.tr('result.r3_long') };
            }
            results.push(r3);

            // 4) Độ dài nội dung (số từ) (0.5)
            const words = wordCount(text);
            results.push(this.rangeResult(4, words, [300,1800], [[150,299],[1801,Infinity]], 0.5,
              this.tr('result.r4_ok'), this.tr('result.r4_warn'), this.tr('result.r4_bad')));

            // 5) Từ khóa chính ở đầu tiêu đề (1.0)
            const tl = toLower(title.trim());
            let r5 = { key:5, status:'red', pts:0, msg:this.tr('result.r5_bad') };
            if (tl.startsWith(kMain) && kMain) {
              r5 = { key:5, status:'green', pts:1.0, msg:this.tr('result.r5_good') };
            } else if (kMain && tl.includes(kMain)) {
              r5 = { key:5, status:'orange', pts:0.5, msg:this.tr('result.r5_warn') };
            }
            results.push(r5);

            // 6) Từ khóa trong mô tả meta: chỉ cần từ khóa chính (0.5)
            const ml = toLower(meta);
            const hasMainMeta = kMain && ml.includes(kMain);
            const hasSubMeta = kSub && ml.includes(kSub);
            let r6 = { key:6, status:'red', pts:0, msg:this.tr('result.r6_bad') };
            if (hasMainMeta) {
              r6 = { key:6, status:'green', pts:0.5, msg:this.tr('result.r6_good') };
            } else if (hasSubMeta) {
              r6 = { key:6, status:'orange', pts:0.25, msg:this.tr('result.r6_warn') };
            }
            results.push(r6);

            // 7) H1 chứa từ khóa chính (1.0)
            const h1s = Array.from(wrapper.querySelectorAll('h1'));
            let r7 = { key:7, status:'red', pts:0, msg:this.tr('result.r7_bad') };
            if (h1s.length) {
              const hasMainH1 = h1s.some(h => toLower(h.textContent).includes(kMain));
              if (hasMainH1) r7 = { key:7, status:'green', pts:1.0, msg:this.tr('result.r7_good') };
              else r7 = { key:7, status:'orange', pts:0.5, msg:this.tr('result.r7_warn') };
            }
            results.push(r7);

            // 8) H2 đầu tiên chứa từ khóa (0.5)
            const firstH2 = wrapper.querySelector('h2');
            let r8 = { key:8, status:'orange', pts:0.25, msg:this.tr('result.r8_warn') };
            if (firstH2 && toLower(firstH2.textContent).includes(kMain)) {
              r8 = { key:8, status:'green', pts:0.5, msg:this.tr('result.r8_good') };
            }
            results.push(r8);

            // 9) Từ khóa ở đoạn đầu & cuối (0.5)
            const arrWords = (text || '').replace(/\n/g,' ').split(/\s+/).filter(Boolean);
            const firstPart = arrWords.slice(0, 100).join(' ').toLowerCase();
            const lastPart = arrWords.slice(Math.max(arrWords.length - 100, 0)).join(' ').toLowerCase();
            const appearStart = kMain && firstPart.includes(kMain);
            const appearEnd = kMain && lastPart.includes(kMain);
            let r9 = { key:9, status:'red', pts:0, msg:this.tr('result.r9_bad') };
            if (appearStart && appearEnd) {
              r9 = { key:9, status:'green', pts:0.5, msg:this.tr('result.r9_good') };
            } else if (appearStart || appearEnd) {
              r9 = { key:9, status:'orange', pts:0.25, msg:this.tr('result.r9_warn') };
            }
            results.push(r9);

            // 10) Hình ảnh & ALT chứa từ khóa (0.5)
            const imgs = Array.from(wrapper.querySelectorAll('img'));
            let r10 = { key:10, status:'red', pts:0, msg:this.tr('result.r10_bad') };
            if (imgs.length) {
              const hasAlt = imgs.some(img => toLower(img.getAttribute('alt') || '').includes(kMain));
              if (hasAlt) r10 = { key:10, status:'green', pts:0.5, msg:this.tr('result.r10_good') };
              else r10 = { key:10, status:'orange', pts:0.25, msg:this.tr('result.r10_warn') };
            }
            results.push(r10);

            // 11) Liên kết ngoài (external) (0.5)
            const anchors = Array.from(wrapper.querySelectorAll('a'));
            const baseDomain = (() => {
              try { return new URL(url).hostname; } catch {
                try { return new URL('http://' + url).hostname; } catch { return ''; }
              }
            })();
            const hasValidUrl = !!baseDomain;
            const isExternal = (href) => {
              if (!href) return false;
              if (!/^https?:/i.test(href)) return false;
              try { const d = new URL(href).hostname; return baseDomain ? (d && d !== baseDomain) : true; } catch { return false; }
            };
            const hasExternal = anchors.some(a => isExternal(a.getAttribute('href')));
            let r11 = { key:11, status:'orange', pts:0.25, msg:this.tr('result.r11_warn') };
            if (hasExternal) r11 = { key:11, status:'green', pts:0.5, msg:this.tr('result.r11_good') };
            results.push(r11);

            // 12) Liên kết nội bộ (internal) (0.5)
            const isInternal = (href) => {
              if (!href) return false;
              if (/^https?:/i.test(href)) {
                try { const d = new URL(href).hostname; return baseDomain ? (d === baseDomain) : false; } catch { return false; }
              }
              return true; // relative link treated as internal
            };
            const hasInternal = anchors.some(a => isInternal(a.getAttribute('href')));
            let r12 = { key:12, status:'orange', pts:0.25, msg: hasValidUrl ? this.tr('result.r12_warn_valid') : this.tr('result.r12_warn_nourl') };
            if (hasValidUrl && hasInternal) r12 = { key:12, status:'green', pts:0.5, msg:this.tr('result.r12_good') };
            results.push(r12);

            // 13) Mật độ từ khóa (%) (3.0) – chuẩn mới: 2.0–5.0% là Đạt
            // Sửa logic đếm để hỗ trợ Unicode (tiếng Việt) và khoảng trắng,
            // không dùng \b vì không tương thích tốt với ký tự có dấu.
            const cleanRaw = toLower(stripTags(raw)).replace(/[^\p{L}\p{N}\s]+/gu, ' ');
            const clean = cleanRaw.replace(/\s+/g, ' ').trim();
            const kwNorm = (kMain || '').replace(/[^\p{L}\p{N}\s]+/gu, ' ').replace(/\s+/g, ' ').trim();
            const totalWords = wordCount(clean);
            const kwWords = wordCount(kwNorm);
            let occ = 0;
            if (kwWords > 0) {
              const kwPattern = kwNorm.split(' ').map(w => escapeRegExp(w)).join('\\s+');
              const rx = new RegExp(`(^|\\s)${kwPattern}(?=\\s|$)`, 'gu');
              occ = (clean.match(rx) || []).length;
            }
            const density = totalWords > 0 ? (occ * kwWords / totalWords) * 100 : 0;
            let r13 = { key:13, status:'red', pts:0, msg:this.trp('result.r13_low', density.toFixed(2)) };
            if (density >= 2.0 && density <= 6.0) {
              r13 = { key:13, status:'green', pts:3.0, msg:this.trp('result.r13_ok', density.toFixed(2)) };
            } else if (density > 6.0) {
              r13 = { key:13, status:'orange', pts:1.5, msg:this.trp('result.r13_high', density.toFixed(2)) };
            }
            results.push(r13);

            // Aggregate
            const lists = {
              green: results.filter(r => r.status === 'green'),
              orange: results.filter(r => r.status === 'orange'),
              red: results.filter(r => r.status === 'red'),
            };
            // Special case: nếu đồng thời có 4 lỗi
            const fourErrors = (
              ((title || '').trim().length === 0) &&
              results.some(r => r.key === 7 && r.status === 'red') &&
              results.some(r => r.key === 4 && r.status === 'red') &&
              results.some(r => r.key === 5 && r.status === 'red')
            );
            const score = fourErrors
              ? 1.0
              : Math.min(10, Math.max(0, results.reduce((s, r) => s + r.pts, 0)));
            const { hint, icon, tone } = this.getScoreDisplay(score);
            setTimeout(() => {
              this.score = score;
              this.lists = lists;
              this.scoreHint = hint;
              this.scoreIcon = icon;
              this.scoreTone = tone || 'green';
              this.isScoring = false;
              
              // Bắn pháo giấy khi đạt điểm 10
              if (score === 10) {
                this.createConfetti();
              }
            }, 500);
          },
          rangeResult(key, value, okRange, warnRanges, maxPts, okMsg, warnMsg, badMsg) {
            let status = 'red', pts = 0, msg = badMsg;
            const [minOk, maxOk] = okRange;
            if (value >= minOk && value <= maxOk) { status = 'green'; pts = maxPts; msg = okMsg; }
            else {
              for (const [wMin, wMax] of warnRanges) {
                const inWarn = value >= wMin && value <= wMax;
                if (inWarn) { status = 'orange'; pts = maxPts / 2; msg = warnMsg; break; }
              }
            }
            return { key, status, pts, msg };
          },
          formatScore(n) {
            try {
              const num = Number(n || 0);
              if (!isFinite(num)) return '0';
              const rounded = Math.round(num * 10) / 10; // one decimal precision
              if (Number.isInteger(rounded)) return String(Math.trunc(rounded));
              return rounded.toFixed(1).replace('.', ',');
            } catch { return '0'; }
          },
          createConfetti() {
            // Sử dụng thư viện canvas-confetti chuyên nghiệp
            confetti({
              particleCount: 120,    // Giảm số lượng hạt từ 200 xuống 120
              spread: 120,           // Tăng độ phân tán từ 90 lên 120 độ
              origin: { y: 1.0 },    // Vị trí bắt đầu từ bottom (1.0 = 100% từ trên xuống)
              colors: ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57', '#ff9ff3', '#54a0ff'],
              startVelocity: 40,     // Tăng tốc độ ban đầu để bắn xa hơn
              gravity: 0.7,          // Giảm trọng lực để bay xa hơn
              drift: 0,              // Độ trôi ngang
              ticks: 140,            // Tăng thời gian sống để hiệu ứng lớn hơn
              scalar: 1.2            // Tăng kích thước tổng thể của từng hạt
            });
          },
          isMainKeywordGood() {
            const kMain = (this.mainKeyword || '').trim();
            const mainWords = this.countWords(kMain);
            const mainChars = kMain.length;
            return mainWords >= 3 && mainWords <= 5 && mainChars < 20;
          },
          isSecondaryKeywordGood() {
            const kSub = (this.secondaryKeyword || '').trim();
            const subWords = this.countWords(kSub);
            const subChars = kSub.length;
            return subWords >= 3 && subWords <= 5 && subChars < 20;
          },
          isTitleGood() {
            const titleLen = (this.title || '').trim().length;
            return titleLen >= 30 && titleLen <= 60;
          },
          isMetaGood() {
            const metaWords = this.countWords(this.meta || '');
            return metaWords >= 30 && metaWords <= 50;
          },
          isContentGood() {
            const contentWords = this.contentWordCount();
            return contentWords >= 300; // Giả sử nội dung tốt cần ít nhất 300 từ
          },
          getScoreDisplay(score) {
            const base = '/Icon SEO point/';
            if (score === 10) {
              return { hint: this.tr('score.hint.master'), icon: base + '10.png', tone: 'green' };
            }
            if ((score >= 8.5 && score <= 9.5) || (score > 9.5 && score < 10)) {
              return { hint: this.tr('score.hint.great'), icon: base + '9,0.png', tone: 'green' };
            }
            if (score >= 5.0 && score <= 8.25) {
              return { hint: this.tr('score.hint.ok'), icon: base + '7,5.png', tone: 'orange' };
            }
            if (score >= 2.25 && score <= 4.75) {
              return { hint: this.tr('score.hint.bad'), icon: base + '4,5.png', tone: 'red' };
            }
            return { hint: this.tr('score.hint.worst'), icon: base + '2,0.png', tone: 'red' };
          }
        }
      });
      app.mount('#app');
    </script>
  </body>
</html>
